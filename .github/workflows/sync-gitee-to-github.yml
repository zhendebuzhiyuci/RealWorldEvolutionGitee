# 工作流名称，可自定义
name: Sync Gitee to GitHub

# 触发条件：1. 每天凌晨 2 点（UTC 时间，对应北京时间 10 点）定时触发；2. 手动触发（在 Actions 页面可点击运行）
on:
  schedule:
    - cron: '0 2 * * *'  # cron 表达式，定时规则：分 时 日 月 周，此处为每天 UTC 2 点
  workflow_dispatch:  # 允许手动触发

# 作业任务
jobs:
  sync:
    # 运行环境：使用最新版 Ubuntu
    runs-on: ubuntu-latest

    # 任务步骤
    steps:
      # 步骤 1：检出 GitHub 目标仓库的代码（为后续推送做准备）
      - name: Checkout GitHub repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 拉取完整的仓库历史，避免同步时丢失提交记录

      # 步骤 2：配置 Git 用户名和邮箱（必须，否则 GitHub 无法识别提交者身份）
      - name: Configure Git
        run: |
          git config --global user.name "gaozhaohua"
          git config --global user.email "gaozhaohua@happymonkey.com.cn"

      # 步骤 3：添加 Gitee 源仓库作为远程仓库，并拉取最新代码
      - name: Pull from Gitee
        run: |
          # 添加 Gitee 远程仓库（利用 Secrets 中的 GITEE_TOKEN 进行身份验证，私有仓库必备）
          # https://gitee.com/buzhiyuci/RealWorldEvolutionGitee.git
          git remote add gitee https:/gaozhaohua/:${{ secrets.GITEE_TOKEN }}@gitee.com/buzhiyuci/RealWorldEvolutionGitee.git
          # 拉取 Gitee 源仓库 main 分支的最新代码（允许合并，解决少量冲突）
          git pull gitee main --allow-unrelated-histories

      # 步骤 4：推送到 GitHub 目标仓库
      - name: Push to GitHub
        run: |
          # 推送到 GitHub 目标仓库的 main 分支（使用 GitHub 自带的 GITHUB_TOKEN 验证，无需额外配置）
          git push origin main
